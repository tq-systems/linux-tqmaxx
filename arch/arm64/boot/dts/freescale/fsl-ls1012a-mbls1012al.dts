// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Device Tree file for TQ LS1012A MBLS1012AL Board.
 *
 * Copyright 2018-2020 TQ-Systems GmbH
 *
 * Authors: Max Merchel <Max.Merchel@tq-group.com>
 *          Matthias Schiffer <matthias.schiffer@tq-group.com>
 */

/dts-v1/;

#include "fsl-ls1012a-tqmls1012al.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/net/ti-dp83867.h>

/ {
	model = "MBLS1012AL starterkit";
	compatible = "tq,ls1012a-mbls1012al", "tq,ls1012a-tqmls1012al", "fsl,ls1012a";

	aliases {
		serial0 = &duart0;
		/* use MAC from U-Boot environment */
		ethernet0 = &pfe_mac0;
		ethernet1 = &pfe_mac1;
		ethernet2 = &swport0;
		ethernet3 = &swport1;
		ethernet4 = &swport2;
		ethernet5 = &swport3;
	};

	chosen {
		linux,stdout-path = &duart0;
		stdout-path = &duart0;
	};

	keys {
		compatible = "gpio-keys";
		status = "okay";

		s2 {
			label = "S2";
			linux,code = <BTN_0>;
			gpios = <&gpio_exp_3p3v 13 GPIO_ACTIVE_LOW>;
		};

		x15 {
			label = "X15";
			linux,code = <BTN_1>;
			gpios = <&gpio_exp_1p8v 5 GPIO_ACTIVE_LOW>;
		};

		x16 {
			label = "X16";
			linux,code = <BTN_2>;
			gpios = <&gpio_exp_1p8v 4 GPIO_ACTIVE_LOW>;
		};
	};

	leds {
		compatible = "gpio-leds";
		status = "okay";

		v15 {
			label = "V15";
			gpios = <&gpio_exp_3p3v 14 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "heartbeat";
		};

		v16 {
			label = "V16";
			gpios = <&gpio_exp_3p3v 15 GPIO_ACTIVE_LOW>;
			default-state = "on";
		};
	};

	memory@80000000 {
		device_type = "memory";
		/*  our minimum RAM config will be 512 MiB */
		reg = <0x00000000 0x80000000 0 0x20000000>;
	};

	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

		/* global autoconfigured region for contiguous allocations */
		linux,cma {
			compatible = "shared-dma-pool";
			reusable;
			/* 64 MiB */
			size = <0 0x04000000>;
			/*  256 - 128 MiB, our minimum RAM config will be 256 MiB */
			alloc-ranges = <0 0x80000000 0 0x88000000>;
			linux,cma-default;
		};
	};

	reg_1p5v: regulator-1p5v {
		compatible = "regulator-fixed";
		regulator-name = "1P5V";
		regulator-min-microvolt = <1500000>;
		regulator-max-microvolt = <1500000>;
		regulator-always-on;
	};

	reg_1p8v: regulator-1p8v {
		compatible = "regulator-fixed";
		regulator-name = "1P8V";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		regulator-always-on;
	};

	reg_3p3v: regulator-3p3v {
		compatible = "regulator-fixed";
		regulator-name = "3P3V";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
	};
};

&duart0 {
	status = "okay";
};

&esdhc0 {
	vmmc-supply = <&reg_3p3v>;
	no-mmc;
	disable-wp;
	sd-uhs-sdr104;
	sd-uhs-sdr50;
	sd-uhs-sdr25;
	sd-uhs-sdr12;
	status = "okay";
};

&i2c0 {
	lm75_48: temperature-sensor@48 {
		compatible = "national,lm75";
		reg = <0x48>;
	};

	gpio_exp_3p3v: gpio-expander@20 {
		compatible = "nxp,pca9555";
		reg = <0x20>;
		gpio-controller;
		#gpio-cells = <2>;
		vcc-supply = <&reg_3p3v>;
		interrupt-parent = <&gpio0>;
		interrupts = <24 IRQ_TYPE_EDGE_FALLING>;

		wlan_disable {
			gpio-hog;
			gpios = <0 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "WLAN_DISABLE#";
		};

		vcc_pcie_en_3v3 {
			gpio-hog;
			gpios = <1 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "VCC_PCIE_EN_3V3";
		};

		vcc_wlan_en_3v3 {
			gpio-hog;
			gpios = <3 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "VCC_WLAN_EN_3V3";
		};

		pcie_rst {
			gpio-hog;
			gpios = <4 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "PCIE_RST#";
		};

		wlan_rst {
			gpio-hog;
			gpios = <5 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "WLAN_RST#";
		};

		usb_rst {
			gpio-hog;
			gpios = <6 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "USB_RST#";
		};

		pcie_dis {
			gpio-hog;
			gpios = <11 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "PCIE_DIS#";
		};

		pcie_wake {
			gpio-hog;
			gpios = <12 GPIO_ACTIVE_HIGH>;
			input;
			line-name = "PCIE_WAKE#";
		};
	};

	gpio_exp_1p8v: gpio-expander@70 {
		compatible = "nxp,pca9538";
		reg = <0x70>;
		gpio-controller;
		#gpio-cells = <2>;
		vcc-supply = <&reg_1p8v>;
		interrupt-parent = <&gpio0>;
		interrupts = <27 IRQ_TYPE_EDGE_FALLING>;

		/* do not change PCIE_CLK_PD */
		pcie_clk_pd {
			gpio-hog;
			gpios = <0 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "PCIE_CLK_PD#";
		};

		pmic_int {
			gpio-hog;
			gpios = <1 GPIO_ACTIVE_HIGH>;
			input;
			line-name = "PMIC_INT#";
		};

		eth_sw_int {
			gpio-hog;
			gpios = <2 GPIO_ACTIVE_HIGH>;
			input;
			line-name = "ETH_SW_INT#";
		};

		eth_link_pwrdwn {
			gpio-hog;
			gpios = <3 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "ETH_LINK_PWRDWN#";
		};

		vcc_wlan_en_1v5 {
			gpio-hog;
			gpios = <6 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "VCC_WLAN_EN_1V5";
		};

		vcc_pcie_en_1v5 {
			gpio-hog;
			gpios = <7 GPIO_ACTIVE_HIGH>;
			output-high;
			line-name = "VCC_PCIE_EN_1V5";
		};
	};

	switch0: ethernet-switch@5f {
		compatible = "microchip,ksz9897";
		reg = <0x5f>;
		vcc-supply = <&reg_1p8v>;
		reset-gpios = <&gpio_exp_3p3v 7 GPIO_ACTIVE_LOW>;
		phy-mode = "rgmii-id";

		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			swport0: port@0 {
				reg = <0>;
				label = "swp0";
			};

			swport1: port@1 {
				reg = <1>;
				label = "swp1";
			};

			swport2: port@2 {
				reg = <2>;
				label = "swp2";
			};

			swport3: port@3 {
				reg = <3>;
				label = "swp3";
			};

			port@6 {
				reg = <6>;
				label = "cpu";
				ethernet = <&pfe_mac1>;

				fixed-link {
					speed = <1000>;
					full-duplex;
				};
			};
		};
	};
};

&pcie1 {
	status = "okay";
};

&pfe {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";

	pfe_mac0: ethernet@0 {
		compatible = "fsl,pfe-gemac-port";
		reg = <0x0>;
		fsl,mdio-mux-val = <0x0>;
		phy-mode = "sgmii";
		phy-handle = <&sgmii_phy>;
	};

	pfe_mac1: ethernet@1 {
		compatible = "fsl,pfe-gemac-port";
		reg = <0x1>;
		fsl,mdio-mux-val = <0x0>;
		phy-mode = "rgmii-id";

		fixed-link {
			speed = <1000>;
			full-duplex;
		};
	};

	mdio@0 {
		#address-cells = <1>;
		#size-cells = <0>;

		sgmii_phy: ethernet-phy@9 {
			compatible = "ethernet-phy-ieee802.3-c22";
			reg = <0x9>;
			reset-names = "phy";
			reset-gpios = <&gpio_exp_3p3v 8 GPIO_ACTIVE_LOW>;
			reset-assert-us = <1>;
			reset-deassert-us = <200>;
			ti,led-function = <0x050b>;
			ti,led-ctrl = <0x1414>;
			ti,clk-output-sel = <DP83867_CLK_O_SEL_OFF>;
			ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
		};
	};
};

&sata {
	status = "okay";
};
